@model IEnumerable<Realtors_Portal.Models.Category>

@{
    ViewBag.Title = "Danh mục bất động sản";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid mt-4">

    <!-- Thông báo -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            <i class="fa fa-check-circle"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            <i class="fa fa-exclamation-triangle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Tiêu đề và nút thêm -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary">
            <i class="fa fa-folder-open"></i> @ViewBag.Title
        </h2>
        <a href="@Url.Action("Create")" class="btn btn-success">
            <i class="fa fa-plus"></i> Thêm danh mục
        </a>
    </div>

    <!-- Bảng danh mục -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle w-100">
            <thead class="table-dark">
                <tr>
                    <th style="width: 35%">Tên danh mục</th>
                    <th style="width: 35%">Mô tả</th>
                    <th style="width: 20%">Danh mục cha</th>
                    <th class="text-center" style="width: 10%">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @helper RenderCategory(IEnumerable<Realtors_Portal.Models.Category> categories, int? parentId, int level = 0)
                {
                    var children = categories.Where(c => c.ParentCategoryID == parentId);
                    foreach (var cat in children)
                    {
                        <tr>
                            <td style="padding-left:@(level * 25)px">
                                @if (level > 0)
                                {
                                    <span class="text-secondary me-1">
                                        @for (int i = 0; i < level; i++)
                                        {
                                            <i class="fa fa-angle-right"></i>
                                        }
                                    </span>
                                }
                                <strong>@cat.CategoryName</strong>
                            </td>
                            <td>@cat.Description</td>
                            <td>@(parentId == null ? "--" : categories.FirstOrDefault(p => p.CategoryID == parentId)?.CategoryName)</td>
                            <td class="text-center">
                                <a href="@Url.Action("Edit", new { id = cat.CategoryID })" class="btn btn-sm btn-warning me-1" title="Chỉnh sửa">
                                    <i class="fa fa-edit"></i>
                                </a>
                                <a href="@Url.Action("Details", new { id = cat.CategoryID })" class="btn btn-sm btn-info text-white me-1" title="Chi tiết">
                                    <i class="fa fa-eye"></i>
                                </a>
                                <a href="@Url.Action("Delete", new { id = cat.CategoryID })"
                                   class="btn btn-sm btn-danger"
                                   title="Xóa"
                                   onclick="return confirm('Bạn có chắc muốn xóa danh mục này không?');">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>

                        @RenderCategory(categories, cat.CategoryID, level + 1)
                    }
                }

                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center text-muted py-4">
                            <i class="fa fa-info-circle"></i> Chưa có danh mục nào
                        </td>
                    </tr>
                }
                else
                {
                    @RenderCategory(Model, null)
                }
            </tbody>
        </table>
    </div>
</div>
