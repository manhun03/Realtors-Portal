window.FrontEnd || (window.FrontEnd = {}); FrontEnd.SearchingSuggestionServices = function () { function et(n) { return new Promise(function (t) { var r = $("#staticDomain").data("sug-api-b2b") || "https://suggestions.batdongsan.com.vn/suggest", i = new URL(r); i.searchParams.append("keyword", n); i.searchParams.append("projectType", 1); fetch(i.href, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json", "Verify-Token": document.querySelector("#staticDomain") ? document.querySelector("#staticDomain").getAttribute("data-verify-token") : "" } }).then(n => n.json()).then(function (n) { t(n) }) }) } function ft(u, o, h = 7, v = 2) { return n == !1 ? (n = !0, new Promise(function (y) { var b = UnicodeToKoDau(u).trim(), k, nt, w, d, tt, g; localStorage && (k = JSON.parse(localStorage.getItem(l)), nt = new Date(localStorage.getItem(p))); (!k || !nt || nt && s(new Date, nt) >= t.hours) && (k = {}, localStorage.setItem(p, (new Date).toUTCString())); w = k[`${b}_${o}`]; w ? (d = [], d.push({ id: null, label: u, value: u }), d = d.concat(w), n = !1, y(d)) : o == i ? et(b).then(function (t) { for (var r, i = [], e = [], s = 0; s < t.length; s++)r = t[s], r.Type == 5 ? i.push(f(r, u, o)) : e.push(f(r, u, o)); e.length > 0 && (i = i.slice(0, h - v), i = i.concat(e)); i = i.slice(0, h); Promise.all(i).then(t => { w = t; k[`${u}_${o}`] = w; localStorage && localStorage.setItem(l, JSON.stringify(k)); var i = []; i.push({ id: null, label: u, value: u }); i = i.concat(w); n = !1; y(i) }) }).catch(function () { n = !1; y([]) }) : (tt = document.querySelector("#staticDomain") ? document.querySelector("#staticDomain").getAttribute("data-sug-api-consumer") : "https://suggestions.batdongsan.com.vn/suggest", g = new URL(tt), g.searchParams.append("keyword", b), o === a && (g.searchParams.append("categoryId", o), g.searchParams.append("size", h)), e === !0 && g.searchParams.append("strictType", c.EXCLUDE_CATEGORY), fetch(g.href, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json", "Verify-Token": document.querySelector("#staticDomain").getAttribute("data-verify-token") || "" } }).then(n => n.json()).then(function (t) { for (var s, p, i = [], c = [], d = "|", e = 0; e < t.length; e++)if (s = t[e], o == r) { if (p = s.Intent == 1 ? r : a, i.length >= h && p == r || c.length >= v && p != r) continue; p == r ? (i.push(f(s, b, o)), d += `${e}|`) : (c.push(f(s, b, o)), d += `${e}|`); i = i.slice(0, h - c.length) } else i.push(f(s, b, o)); if (i = i.concat(c), i.length < h && o == r) for (e = 0; e < t.length && i.length < h; e++)d.indexOf(`|${e}|`) == -1 && t[e].Intent == 2 && i.push(f(t[e], b, o)); Promise.all(i).then(t => { w = t; k[`${b}_${o}`] = w; localStorage && localStorage.setItem(l, JSON.stringify(k)); var i = []; i.push({ id: null, label: u, value: u }); i = i.concat(w); n = !1; y(i) }) }, function () { n = !1; y(d) })) })) : new Promise(function (n) { n([]) }) } function ot(t, i = 38) { return n == !1 ? (n = !0, new Promise(function (r) { var e = UnicodeToKoDau(t).trim(), o = document.querySelector("#staticDomain") ? document.querySelector("#staticDomain").getAttribute("data-sug-api-consumer") : "https://suggestions.batdongsan.com.vn/suggest", u = new URL(o); u.searchParams.append("keyword", e); u.searchParams.append("size", 10); u.searchParams.append("strictType", c.EXCLUDE_CATEGORY); u.searchParams.append("categoryId", i); fetch(u.href, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json", "Verify-Token": document.querySelector("#staticDomain").getAttribute("data-verify-token") || "" } }).then(n => n.json()).then(function (u) { for (var h, s = [], o = 0; o < u.length; o++)h = u[o], s.push(f(h, e, i)); Promise.all(s).then(i => { data = i; var u = []; u.push({ id: null, label: t, value: t }); u = u.concat(data); n = !1; r(u) }) }, function () { n = !1; r(result) }) })) : new Promise(function (n) { n([]) }) } function f(n, t, i) { var u = n.Intent == 1 ? r : a, f = n.CategoryId == u ? null : n.CategoryId; return new Promise(r => { ct(n, t).then(e => { r({ id: { city: n.CityCode, distr: n.DistrictId, wardid: n.WardId, streetid: n.StreetId, projid: n.ProjectId, projcate: null, productType: u, categoryId: f, minarea: n.FromArea, maxarea: n.ToArea, minprice: n.FromPrice, maxprice: n.ToPrice, directionid: n.DirectionId, roomid: n.RoomNumber, ts: 0, tr: 0 }, labelComponent: st(n, i), shortcutRules: e, hightlightTexts: ht(n, t, e), label: n.FullName, value: n.FullName }) }) }) } function st(n, t) { return { category: e && t != i ? null : n.CategoryName, city: n.CityName, district: n.DistrictName, ward: n.WardName, street: n.StreetName, project: n.ProjectName, name: n.Name, matchName: n.MatchName, hightlight: n.Highlight } } function s(n, t) { return Math.round(n.getTime() - t.getTime()) / 36e5 } function o(n, t, i, r) { function u() { var s, o, f, e; if (!t || (s = y(n, r), i >= s)) return n; if (o = t.shift(), o) { for (f = n.split(",").map(n => n.trim()), e = 0; e < f.length; e++)f[e].toLocaleLowerCase() == o.from.toLocaleLowerCase() && (f[e] = o.to); n = f.join(", ") } else return n; return u() } return i && r ? n = u() : n } function ht(n, t, i) { var u = n.Highlight ? n.Highlight.split(" ") : t.split(" "), r = n.Highlight; return i.forEach(n => { var t, i; n.to != "..." && (t = r.toLocaleLowerCase().indexOf(n.from.replace("...", "").toLocaleLowerCase()), t >= 0 && (i = r.substring(t, n.from.replace("...", "").length), r = r.replace(i, n.to.replace("...", "")), r.split(" ").forEach(t => { u.indexOf(t) == -1 && (n.from.indexOf("...") >= 0 ? u.push(t + "...") : u.push(t)) }))) }), u } function ct(n, t) { function u(n) { var a = "SEARCHUNG_SUGGESTION_SHORTCUT_RULES_V1", o = n, r = at(a), v, c, t, l, u, e, i, h, y; if (r || (r = {}), r[o]) return r[o]; if (v = [{ id: "Thá»«a ThiĂªn Huáº¿", shortcuts: ["Thá»«a ThiĂªn Huáº¿", "TT.Huáº¿"] }, { id: "ThĂ nh phá»‘ Phan Rang - ThĂ¡p ChĂ m", shortcuts: ["ThĂ nh phá»‘ Phan Rang - ThĂ¡p ChĂ m", "Phan Rang ThĂ¡p ChĂ m", "Phan Rang - ThĂ¡p ChĂ m", "P.Rang-T.ChĂ m", "PR-TC"] }, { id: "BĂ  Rá»‹a VÅ©ng TĂ u", shortcuts: ["BĂ  Rá»‹a VÅ©ng TĂ u", "B.Rá»‹a-V.TĂ u", "BR-VT"] }, { id: "Há»“ ChĂ­ Minh", shortcuts: ["Há»“ ChĂ­ Minh", "TP.HCM"] }], c = Object.keys(r), c.length > 200 && delete r[c[200 * Math.random() << 0]], t = [], l = v.filter(t => t.id.toLocaleUpperCase() == n.toLocaleUpperCase()), l.length) t = l[0].shortcuts, r[o] = t.map((n, i) => ({ from: n, to: i + 1 < t.length ? t[i + 1] : "", primary: 3 })).filter(n => n.to); else { t.push(n); var p = { "quáº­n": "Q", "xĂ£": "X", "Ä‘Æ°á»ng": "Ä", "phÆ°á»ng": "P", "phá»‘": "P", "thĂ nh phá»‘": "TP", "thá»‹ tráº¥n": "TT", "thá»‹ xĂ£": "TX", "Ä‘áº·c khu hĂ nh chĂ­nh": "ÄK", "huyá»‡n Ä‘áº£o": "HÄ", "xĂ£ Ä‘áº£o": "XÄ" }, f = "", s = ""; if (["quáº­n", "xĂ£", "Ä‘Æ°á»ng", "phÆ°á»ng", "phá»‘", "thĂ nh phá»‘", "thá»‹ tráº¥n", "thá»‹ xĂ£", "Ä‘áº·c khu hĂ nh chĂ­nh", "huyá»‡n Ä‘áº£o", "xĂ£ Ä‘áº£o"].forEach(t => { var i = n.toLocaleLowerCase().indexOf(t); i >= 0 && (f = n.substring(i, t.length), s = p[t]) }), f && s && (t.push(n.replace(`${f} `, `${s}.`)), n = n.replace(`${f} `, ""), +n || t.push(n)), !+n) { for (u = "", e = "", i = 0; i < n.length; i++)if (n[i] && n[i] != " ") { if (!u) if (+n[i]) { for (h = i; n[h] && n[h] != " ";)h++; y = h - i; u = n.substr(i, y); +n[i] ? e += u : (u = n[i].toUpperCase(), e += u) } else u = n[i].toUpperCase(), e += u } else t.push(`${u}.${n.substr(i + 1)}`), u = ""; e.length > 1 && t.push(e) } r[o] = t.map((n, i) => { var r = 3; return f && n.indexOf(f) >= 0 ? r = 1 : s && n.indexOf(s) >= 0 && i - 1 >= 0 && t[i - 1].indexOf(f) >= 0 && (r = 2), { from: n, to: i + 1 < t.length ? t[i + 1] : "", primary: r } }).filter(n => n.to) } return vt(a, r), r[o] } var i = [], r; if (n.CityName && i.push(new Promise(t => t(u(n.CityName)))), n.DistrictName && i.push(new Promise(t => t(u(n.DistrictName)))), n.WardName && i.push(new Promise(t => t(u(n.WardName)))), n.StreetName && i.push(new Promise(function (t) { t(u(n.StreetName)) })), n.ProjectId) { function r(i) { return new Promise(function (r) { function s(n, t, i) { return n.substr(0, t) + i + n.substr(t + i.length) } var e = [], l = n.Highlight ? n.Highlight.split(" ") : t.split(" "), f, o, h, c, u; if (l.forEach(n => { var r, t; if (n && (r = i.toLocaleLowerCase().indexOf(n.toLocaleLowerCase()), r >= 0)) for (t = 0; t < n.length; t++)e.push(r + t) }), e = e.sort((n, t) => n - t), f = [], i = i.replaceAll(".", "[dot]"), f.push(i), o = i.length, e.length) for (h = e[e.length - 1], c = e[0], u = 0; u < o; u++)o - (u + 1) > h && (i = s(i, o - (u + 1), "."), f.indexOf(i) == -1 && i.indexOf("...") >= 0 && f.push(i)), u < c && (i = s(i, u, "."), f.indexOf(i) == -1 && i.indexOf("...") >= 0 && f.push(i)); for (o = i.length, u = 0; u < i.length; u++)i[o - (u + 1)] != "." && (i = s(i, o - (u + 1), "."), f.indexOf(i) == -1 && i.indexOf("...") >= 0 && f.push(i)); for (u = 0; u < f.length; u++) { while (f[u].indexOf("..") >= 0) f[u] = f[u].replaceAll("..", "."); f[u] = f[u].replaceAll(".", "..."); f[u] = f[u].replaceAll("[dot]", ".") } r(f.map((n, t) => ({ from: n, to: f[t + 1], primary: 3 }))) }) } n.MatchName && n.Highlight && n.MatchName.indexOf(n.Highlight) >= 0 && n.ProjectName.indexOf(n.Highlight) == -1 ? (i.push(r(n.MatchName)), i.push(r(`${n.MatchName} (${n.ProjectName})`))) : i.push(r(n.ProjectName)) } return r = [], new Promise(n => { Promise.all(i).then(t => { t.forEach(n => { r = r.concat(n) }), r = r.filter(n => n.to).sort((n, t) => n.primary - t.primary), n(r) }) }) } function v(n, t, i) { var f = ["bĂ¡n", "cho thuĂª"], r = i, u, e, o; if (n == 38 ? (r = "NhĂ  Ä‘áº¥t", t && (r = i), t == 324 ? r = "CÄƒn há»™ chung cÆ°" : t == 650 ? r = "CÄƒn há»™ chung cÆ° mini, cÄƒn há»™ dá»‹ch vá»¥" : t == 362 ? r = "CĂ¡c loáº¡i nhĂ  bĂ¡n" : t == 41 ? r = "NhĂ  riĂªng" : t == 325 ? r = "NhĂ  biá»‡t thá»±, liá»n ká»" : t == 163 ? r = "NhĂ  máº·t phá»‘" : t === 575 ? r = "Shophouse, nhĂ  phá»‘ thÆ°Æ¡ng máº¡i" : t == 361 ? r = "CĂ¡c loáº¡i Ä‘áº¥t bĂ¡n" : t == 40 ? r = "Äáº¥t ná»n dá»± Ă¡n" : t == 283 ? r = "Äáº¥t" : t == 44 ? r = "Trang tráº¡i, khu nghá»‰ dÆ°á»¡ng" : t == 562 ? r = "Condotel" : t == 45 ? r = "Kho, nhĂ  xÆ°á»Ÿng" : t == 48 && (r = "Loáº¡i bÄ‘s khĂ¡c")) : n == 49 && (r = "ThuĂª nhĂ  Ä‘áº¥t", t && (r = i), t == 326 ? r = "ThuĂª cÄƒn há»™ chung cÆ°" : t == 651 && (r = "ThuĂª cÄƒn há»™ chung cÆ° mini, cÄƒn há»™ dá»‹ch vá»¥"), t == 52 && (r = "ThuĂª nhĂ  riĂªng"), t == 577 ? r = "ThuĂª nhĂ  biá»‡t thá»±, liá»n ká»" : t == 51 ? r = "ThuĂª nhĂ  máº·t phá»‘" : t == 576 ? r = "ThuĂª shophouse, nhĂ  phá»‘ thÆ°Æ¡ng máº¡i" : t == 57 ? r = "ThuĂª nhĂ  trá», phĂ²ng trá»" : t == 50 ? r = "ThuĂª vÄƒn phĂ²ng" : t == 55 ? r = "ThuĂª, sang nhÆ°á»£ng cá»­a hĂ ng, ki á»‘t" : t == 53 ? r = "ThuĂª kho, xÆ°á»Ÿng, Ä‘áº¥t" : t == 59 && (r = "ThuĂª bÄ‘s khĂ¡c")), r == i) for (u = 0; u < f.length; u++)e = r.toLocaleLowerCase().indexOf(f[u]), e >= 0 && (o = r.substr(e, f[u].length), r = r.replace(o, "").trim(), r = r[0].toLocaleUpperCase() + r.substr(1)); return r } function y(n, t = lt()) { const r = y.canvas || (y.canvas = document.createElement("canvas")), i = r.getContext("2d"); i.font = t; const u = i.measureText(n); return u.width } function lt(n = document.body) { function t(n, t) { return window.getComputedStyle(n, null).getPropertyValue(t) } const i = t(n, "font-weight") || "normal", r = t(n, "font-size") || "16px", u = t(n, "font-family") || "Times New Roman"; return `${i} ${r} ${u}` } function at(n) { if (localStorage) { var t = localStorage.getItem(n); if (t) return JSON.parse(t) } return null } function vt(n, t) { localStorage && t && localStorage.setItem(n, JSON.stringify(t)) } function yt(n) { let t = 2166136261; for (let i = 0; i < n.length; i++)t ^= n.charCodeAt(i), t = t + (t << 1) + (t << 4) + (t << 7) + (t << 8) + (t << 24) >>> 0; return ("0000000" + t.toString(16)).slice(-8) } var h = "v1", l = "SEARCHING_SUGGESTION", p = "SEARCHING_SUGGESTION_SAVED_TIME", w = `SEARCH_LOCATION_SUGGESTION_${h}`, b = `SEARCH_LOCATION_SUGGESTION_SAVED_TIME_${h}`, k = "SEARCH_POPULAR_SUGGESTION", d = "SEARCH_POPULAR_SUGGESTION_SAVED_TIME", g = "SEARCH_DISTRICTS_SUGGESTION_ORDER", nt = "SEARCH_DISTRICTS_SUGGESTION_ORDER_SAVED_TIME", tt = `SEARCH_KEYWORD_SUGGESTION_${h}`, it = `SEARCH_KEYWORD_SUGGESTION_SAVED_TIME_${h}`, n = !1, r = 38, a = 49, i = 351, u, t; const c = { ALL: 0, ONLY_LOCATION: 1, ONLY_PROJECT: 2, EXCLUDE_CATEGORY: 3 }, rt = { ONLY_LOCATION: 0, ONLY_PROJECT: 1, ALL: 2 }, ut = { Project: 5, District: 3, Ward: 6, Street: 2, City: 1 }; u = null; t = document.querySelector("script[searching-suggestions-service-params]") ? JSON.parse(document.querySelector("script[searching-suggestions-service-params]").getAttribute("searching-suggestions-service-params")) : {}; const e = document.querySelector("#staticDomain") !== undefined && document.querySelector("#staticDomain").getAttribute("data-new-api-suggestion") !== undefined ? document.querySelector("#staticDomain").getAttribute("data-new-api-suggestion").toLowerCase() === "true" : !1; this.getLocationSuggestions = function (r) { return new Promise(function (f) { var a = [], p = UnicodeToKoDau(r.keyword).trim(), h, v = `${p}_${r.productType}_${r.cityCode}_${r.size}`, l, e, y, o; localStorage && (h = JSON.parse(localStorage.getItem(w)), l = new Date(localStorage.getItem(b))); (!h || !l || l && s(new Date, l) >= t.hours) && (h = {}, localStorage.setItem(b, (new Date).toUTCString())); e = h[v]; e ? (n = !1, f(e)) : (u && u.abort(), u = new AbortController, y = document.querySelector("#staticDomain") ? document.querySelector("#staticDomain").getAttribute("data-sug-api-consumer") : "https://suggestions.batdongsan.com.vn/suggest", o = new URL(y), o.searchParams.append("keyword", r.keyword), o.searchParams.append("city", r.cityCode), o.searchParams.append("size", r.size + 1), r.productType == i ? o.searchParams.append("projectType", c.ONLY_LOCATION) : (o.searchParams.append("strictType", c.EXCLUDE_CATEGORY), o.searchParams.append("categoryId", r.productType)), fetch(o.href, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json", "Verify-Token": document.querySelector("#staticDomain").getAttribute("data-verify-token") || "" }, signal: u.signal }).then(n => n.json()).then(function (t) { var i = t; Promise.all(i).then(t => { e = t, h[v] = e, localStorage && e && e.length > 0 && localStorage.setItem(w, JSON.stringify(h)), n = !1, f(e) }) }, function (t) { if (t.name === "AbortError") { console.debug("Request was cancelled, don't resolve or reject"); return } n = !1; f(a) }).catch(function (t) { if (t.name === "AbortError") { console.debug("Request was cancelled, don't resolve or reject"); return } n = !1; f(a) })) }) }; this.getKeywordSuggestions = function (r) { return new Promise(function (f) { var a = [], v = r.keyword.trim(), o, y, l, c, e, p, h; let w = yt(v); y = "KeywordSuggestion"; l = `${y}_${UnicodeToKoDau(v)}_${r.size}_${w}`; localStorage && (o = JSON.parse(localStorage.getItem(tt)), c = new Date(localStorage.getItem(it))); (!o || !c || c && s(new Date, c) >= t.hours) && (o = {}, localStorage.setItem(it, (new Date).toUTCString())); e = o[l]; e ? (n = !1, f(e)) : (u && u.abort(), u = new AbortController, p = document.querySelector("#staticDomain") ? document.querySelector("#staticDomain").getAttribute("data-sug-renovate-api-consumer") : "https://suggestions.batdongsan.com.vn/suggest", h = new URL(p), h.searchParams.append("keyword", r.keyword), h.searchParams.append("size", r.size), r.productType == i ? h.searchParams.append("strictType", rt.ONLY_PROJECT) : h.searchParams.append("strictType", rt.ALL), fetch(h.href, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json", "Verify-Token": document.querySelector("#staticDomain").getAttribute("data-renovate-verify-token") || "" }, signal: u.signal }).then(n => n.json()).then(function (t) { var i = t.data; Promise.all(i).then(t => { e = t.slice(0, r.size), o[l] = e, localStorage && e && e.length > 0 && localStorage.setItem(tt, JSON.stringify(o)), n = !1, f(e) }) }, function (t) { if (t.name === "AbortError") { console.debug("Request was cancelled, don't resolve or reject"); return } n = !1; f(a) }).catch(function (t) { if (t.name === "AbortError") { console.debug("Request was cancelled, don't resolve or reject"); return } n = !1; f(a) })) }) }; this.getPopularSuggestions = function (u) { return new Promise(function (f) { var l = [], o, c = `${u.productType}_${u.cateId}_${u.cityCode}_${u.size}`, h, e; if (localStorage && (o = JSON.parse(localStorage.getItem(k)), h = new Date(localStorage.getItem(d))), (!o || !h || h && s(new Date, h) >= t.hours) && (o = {}, localStorage.setItem(d, (new Date).toUTCString())), e = o[c], e) n = !1, f(e); else { let s = u.productType == i ? r : u.productType, h = u.productType == i ? 324 : u.cateId, a = u.size ? u.size : u.productType == i ? 20 : 10, v = `${u.apiPopularSuggestion}?productType=${s}&cateId=${h}&cityCode=${u.cityCode}&pageSize=${a}`, t = null; AbortSignal && AbortSignal.timeout && (t = AbortSignal.timeout(1e4)); fetch(v, { method: "GET", signal: t, headers: { Accept: "application/json", "Content-Type": "application/json" } }).then(n => n.json()).then(function (t) { var r = []; let h = 10, s = 0; t && t.length > 0 && t.forEach(n => { s < h && (u.productType != i || u.productType == i && (n.type == ut.Project || n.type == ut.District)) && (r.push({ ScopeId: s, FullName: n.fullName, Name: n.name, Value: n.value, MatchName: "", Highlight: "", LocationLevel: n.location_level, Type: n.type, ProjectId: n.project_id, StreetId: n.street_id, WardId: n.ward_id, DistrictId: n.district_id, CityCode: n.city_code, StreetName: n.street_name, WardName: n.ward_name, DistrictName: n.district_name, CityName: n.city_name, ProjectName: n.project_name, TotalPageReview: n.total_pageview, DistrictPrefix: n.districtPrefix, WardPrefix: n.wardPrefix, StreetPrefix: n.streetPrefix }), s++) }); r && r.length ? Promise.all(r).then(t => { e = t, o[c] = e, localStorage && e && e.length > 0 && localStorage.setItem(k, JSON.stringify(o)), n = !1, f(e) }) : f([]) }, function () { n = !1; f(l) }).catch(() => { f([]) }) } }) }; this.getDistrictsSuggestions = function (i) { return new Promise(function (r) { var h = [], f, o = `${i.cityCode}`, e, u; if (localStorage && (f = JSON.parse(localStorage.getItem(g)), e = new Date(localStorage.getItem(nt))), (!f || !e || e && s(new Date, e) >= t.hours) && (f = {}, localStorage.setItem(nt, (new Date).toUTCString())), u = f[o], u) n = !1, r(u); else { let t = `${i.apiDistrictsSuggestion}?cityCode=${i.cityCode}`; fetch(t, { method: "GET", headers: { Accept: "application/json", "Content-Type": "application/json" } }).then(n => n.json()).then(function (t) { var i = []; let e = 0; t.forEach(n => { i.push({ ScopeId: e, FullName: n.districtFullName, Name: n.districtName, Value: n.districtId, DistrictName: n.districtFullName, CityName: n.cityName, DistrictId: n.districtId, CityCode: n.cityCode, MatchName: "", Highlight: "", LocationLevel: 3, Type: 3, ProjectId: 0, StreetId: 0, WardId: 0, StreetName: "", WardName: "", ProjectName: "" }), e++ }); Promise.all(i).then(t => { u = t, f[o] = u, localStorage && u && u.length > 0 && localStorage.setItem(g, JSON.stringify(f)), n = !1, r(u) }) }, function () { n = !1; r(h) }) } }) }; this.GetSuggestionsForWeb = function (n) { return new Promise(function (t, r) { ft(n.text, n.productType, n.size, n.sizeOfRecommendation).then(function (r) { for (var f, u = 0; u < r.length; u++)n.productType == i ? (r[u].labelComponent && r[u].id.projid && r[u].id.projid > 0 && (r[u].value = r[u].label), r[u].shortcutRules && r[u].width && r[u].style && (r[u].label = o(r[u].label, r[u].shortcutRules, r[u].width, r[u].style))) : r[u].labelComponent && (n.productType != i && e === !1 && (r[u].labelComponent.category = v(r[u].id.productType, r[u].id.categoryId, r[u].labelComponent.category)), f = e ? [] : [r[u].labelComponent.category], r[u].id.projid ? r[u].labelComponent.matchName && r[u].labelComponent.hightlight && r[u].labelComponent.matchName.indexOf(r[u].labelComponent.hightlight) >= 0 && r[u].labelComponent.project.indexOf(r[u].labelComponent.hightlight) == -1 ? r.filter(n => n.labelComponent && n.labelComponent.matchName == r[u].labelComponent.matchName && n.id.productType == r[u].id.productType && n.id.categoryId == r[u].id.categoryId).length > 1 ? f.push(`${r[u].labelComponent.matchName} (${r[u].labelComponent.project})`) : f.push(r[u].labelComponent.matchName) : f.push(r[u].labelComponent.project) : r[u].id.streetid ? f.push(r[u].labelComponent.street) : r[u].id.wardid && f.push(r[u].labelComponent.ward), r[u].id.distr && f.push(r[u].labelComponent.district), r[u].id.city && f.push(r[u].labelComponent.city), r[u].label = f.join(", "), r[u].value = r[u].label, r[u].shortcutRules && n.width && n.style && (r[u].label = o(r[u].label, r[u].shortcutRules, n.width, n.style))); t(r) }).catch(n => { r(n) }) }) }; this.GetSuggestionsForWap = function (n) { return new Promise(function (t, r) { ft(n.text, n.productType, n.size, n.sizeOfRecommendation).then(function (r) { for (var h, s, f, l, u = 0; u < r.length; u++)if (n.productType == i) { if (r[u].labelComponent && r[u].id.projid && r[u].id.projid > 0) { var c = r[u].label.split(", "), s = [], f = []; for (h = 0; h < c.length; h++)h <= 0 || r[u].labelComponent.street.toLocaleLowerCase() == c[h].toLocaleLowerCase() ? s.push(c[h]) : f.push(c[h]); l = [o(s.filter(n => n).join(", "), JSON.parse(JSON.stringify(r[u].shortcutRules)), n.widthLine1, n.styleLine1), f.filter(n => n).length ? o(f.filter(n => n).join(", "), JSON.parse(JSON.stringify(r[u].shortcutRules)), n.widthLine2, n.styleLine2) : null].filter(n => n); r[u].label = JSON.stringify(l); r[u].value = r[u].label } } else r[u].labelComponent && !e && (r[u].labelComponent.category = v(r[u].id.productType, r[u].id.categoryId, r[u].labelComponent.category), s = e ? [] : [r[u].labelComponent.category], f = [], r[u].id.projid ? (r[u].labelComponent.matchName && r[u].labelComponent.hightlight && r[u].labelComponent.matchName.indexOf(r[u].labelComponent.hightlight) >= 0 && r[u].labelComponent.project.indexOf(r[u].labelComponent.hightlight) == -1 ? r.filter(n => n.labelComponent && n.labelComponent.matchName == r[u].labelComponent.matchName && n.id.productType == r[u].id.productType && n.id.categoryId == r[u].id.categoryId).length > 1 ? s.push(`${r[u].labelComponent.matchName} (${r[u].labelComponent.project})`) : s.push(r[u].labelComponent.matchName) : s.push(r[u].labelComponent.project), r[u].id.streetid && s.push(r[u].labelComponent.street), r[u].id.wardid && f.push(r[u].labelComponent.ward), r[u].id.distr && f.push(r[u].labelComponent.district), r[u].id.city && f.push(r[u].labelComponent.city)) : r[u].id.streetid ? (s.push(r[u].labelComponent.street), r[u].id.wardid && f.push(r[u].labelComponent.ward), r[u].id.distr && f.push(r[u].labelComponent.district), r[u].id.city && f.push(r[u].labelComponent.city)) : r[u].id.wardid ? (s.push(r[u].labelComponent.ward), r[u].id.distr && f.push(r[u].labelComponent.district), r[u].id.city && f.push(r[u].labelComponent.city)) : r[u].id.distr ? (s.push(r[u].labelComponent.district), r[u].id.city && f.push(r[u].labelComponent.city)) : r[u].id.city && s.push(r[u].labelComponent.city), l = [o(s.filter(n => n).join(", "), JSON.parse(JSON.stringify(r[u].shortcutRules)), n.widthLine1, n.styleLine1), f.filter(n => n).length ? o(f.filter(n => n).join(", "), JSON.parse(JSON.stringify(r[u].shortcutRules)), n.widthLine2, n.styleLine2) : null].filter(n => n), r[u].label = JSON.stringify(l), r[u].value = r[u].label); t(r) }).catch(n => { r(n) }) }) }; this.GetLocationsForSearchPricingHistory = function (n) { return ot(n.text, n.productType) }; this.GetNearMeTrackingAttributes = function () { return `tracking-id="${t.trackingInfo.id}" tracking-label="type=${t.trackingInfo.nearMe}"` }; this.GetHistoryTrackingAttributes = function () { return `tracking-id="${t.trackingInfo.id}" tracking-label="type=${t.trackingInfo.history}"` }; this.GetLocationTrackingAttributes = function (n) { return `tracking-id="${t.trackingInfo.id}" tracking-label="type=${t.trackingInfo.location};query=${n}"` }; this.GetProjectTrackingAttributes = function (n) { return `tracking-id="${t.trackingInfo.id}" tracking-label="type=${t.trackingInfo.project};query=${n}"` }; this.GetKeywordTrackingAttributes = function (n) { return `tracking-id="${t.trackingInfo.id}" tracking-label="query=${n}"` }; this.GetShortcutOfCategory = v };