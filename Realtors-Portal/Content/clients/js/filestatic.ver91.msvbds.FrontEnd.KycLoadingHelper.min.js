window.FrontEnd || (window.FrontEnd = {}); FrontEnd.KycLoadingHelper = function () { function r(n) { u(n) } function u(i) { function r(i) { n(`${i.elementSelector}[data-change-marking="1"]`).then(() => { document.querySelector(`${i.elementSelector}[data-change-marking="1"]`).dispatchEvent(new Event("click")), t(() => { if (document.querySelectorAll(i.elementSelector).length) { const n = document.querySelector(".re__ms-srp-section"); return n ? n.scrollTo({ top: i.triggerPositionTop }) : window.scrollTo(0, i.triggerPositionTop), setTimeout(function () { $("#notiSave .re__marked-products-popup").show() }, 3e3), !0 } return !1 }, 100) }, 100) } let u = !i.triggerPage || i.triggerPage <= 1; if (u) { r(i); return } let f = !!i.triggerViewMore; if (f && i.triggerViewMore == "js__kyc-product-extend") { window.scrollTo(0, i.triggerPositionLazyload); n(".js__kyc-product-extend", 100).then(() => { document.querySelectorAll(".js__kyc-product-extend").forEach(n => { n.dispatchEvent(new Event("click")) }); return }).then(() => r(i)); return } let e = !!i.triggerViewMore; if (e && i.triggerViewMore == "js__btnSuggestionBoxEmptyResultPageViewMore") { window.scrollTo(0, i.triggerPositionLazyload); n("#btnSuggestionBoxEmptyResultPageViewMore", 100).then(() => { (function n() { document.querySelector(".js_btn-get-more-suggestion-product-empty-page").getAttribute("class").indexOf(" on") > 0 || (document.getElementById("btnSuggestionBoxEmptyResultPageViewMore").click(), setTimeout(n, 500)) })() }).then(() => r(i)); return } let o = i.triggerPage >= 2; o && n(".js__click-load-page", 100).then(() => t(() => document.querySelectorAll(".js__product-listing .js__card").length >= 21 ? !0 : (document.querySelector(".js__click-load-page").getAttribute("data-click") != "true" && (window.scrollTo(0, document.querySelector(".js__click-load-page").offsetTop - screen.height), document.querySelector(".js__click-load-page").dispatchEvent(new Event("click"))), !1), 100)).then(() => t(() => i.triggerPage == 2 ? !0 : document.querySelectorAll(".js__product-listing .js__card").length >= 41 ? !0 : (document.querySelector(".js__click-load-page").getAttribute("data-clickpage2") != "true" && (window.scrollTo(0, document.querySelector(".js__click-load-page").offsetTop - screen.height), document.querySelector(".js__click-load-page").dispatchEvent(new Event("click"))), !1), 100)).then(() => r(i)) } function f(i) { n(i.elementSelector).then(() => { document.querySelector(i.elementSelector).dispatchEvent(new Event("click")) }); i.scrollContentTop && t(() => window.scrollY == i.triggerPositionTop ? !0 : (window.scrollTo(0, i.triggerPositionTop), !1), 100) } function e(i) { function r(i) { n(i.elementSelector).then(() => { t(() => { if (document.querySelectorAll(i.elementSelector).length && document.querySelector(i.elementSelector).getAttribute("data-click") == "true") { const n = document.querySelector(".re__ms-srp-section"); return n ? n.scrollTo({ top: i.triggerPositionTop }) : window.scrollTo(0, i.triggerPositionTop), !0 } return document.querySelector(i.elementSelector).dispatchEvent(new Event("click")), !1 }, 100, 1e3) }, 100) } document.querySelectorAll(".js__phone-event").length > 0 && document.querySelectorAll(".js__phone-event").forEach(n => { n.setAttribute("tracking-kyc", "true") }); let u = !i.triggerPage || i.triggerPage <= 1; if (u) { r(i); return } let f = !!i.triggerViewMore; if (f && i.triggerViewMore == "js__kyc-product-extend") { window.scrollTo(0, i.triggerPositionLazyload); n(".js__kyc-product-extend", 100).then(() => { document.querySelectorAll(".js__kyc-product-extend").forEach(n => { n.dispatchEvent(new Event("click")) }); return }).then(() => r(i)); return } let e = !!i.triggerViewMore; if (e && i.triggerViewMore == "js__btnSuggestionBoxEmptyResultPageViewMore") { window.scrollTo(0, i.triggerPositionLazyload); n("#btnSuggestionBoxEmptyResultPageViewMore", 100).then(() => { (function n() { document.querySelector(".js_btn-get-more-suggestion-product-empty-page").getAttribute("class").indexOf(" on") > 0 || (document.getElementById("btnSuggestionBoxEmptyResultPageViewMore").click(), setTimeout(n, 500)) })() }).then(() => r(i)); return } let o = i.triggerPage >= 2; o && n(".js__click-load-page", 100).then(() => t(() => document.querySelectorAll(".js__product-listing .js__card").length >= 21 ? !0 : (document.querySelector(".js__click-load-page").getAttribute("data-click") != "true" && (window.scrollTo(0, document.querySelector(".js__click-load-page").offsetTop - screen.height), document.querySelector(".js__click-load-page").dispatchEvent(new Event("click"))), !1), 100)).then(() => t(() => i.triggerPage == 2 ? !0 : document.querySelectorAll(".js__product-listing .js__card").length >= 41 ? !0 : (document.querySelector(".js__click-load-page").getAttribute("data-clickpage2") != "true" && (window.scrollTo(0, document.querySelector(".js__click-load-page").offsetTop - screen.height), document.querySelector(".js__click-load-page").dispatchEvent(new Event("click"))), !1), 100)).then(() => r(i)) } function o(i) { n(i.elementSelector).then(() => t(() => document.querySelector(i.elementSelector).getAttribute("data-click") == "true" ? !0 : (document.querySelector(i.elementSelector).dispatchEvent(new Event("click")), !1), 100)).then(() => { i.scrollContentTop && t(() => window.scrollY == i.triggerPositionTop ? !0 : (window.scrollTo(0, i.triggerPositionTop), !1), 100) }) } function s(n) { new Promise((t, i) => { (function r(t, i, u) { let f = document.querySelector(n.elementSelector) ? document.querySelector(n.elementSelector).offsetTop : 0; if (f) { i(); return } t > 0 ? setTimeout(() => { r(t - 1, i, u) }, 800) : u() })(20, t, i) }).then(() => { let t; (function i(r, u = 0) { var f = window; if (f && Math.round(f.scrollY || f.scrollTop) >= document.querySelector(n.elementSelector).offsetTop || r <= 0) { document.querySelector("body").classList.add("kyc-no-scroll"); return } f.scrollBy(0, u + 20); t = setTimeout(() => { i(r - 1) }, 20) })(1300); document.addEventListener("wheel", () => { clearTimeout(t) }) }) } function n(n, t = 20) { return new Promise((i, r) => { (function u(t) { if (document.querySelectorAll(n).length) { i(); return } if (t) { setTimeout(() => { u(t - 1) }, 500); return } console.error("not found " + n); r() })(t) }) } function t(n, t, i = 500) { return new Promise((r, u) => { (function f(n, t, r, u) { if (n()) { r(); return } if (t) { setTimeout(() => { f(n, t - 1, r, u) }, i); return } u() })(n, t, r, u) }) } const i = "KYC_TRIGGER_TYPE_LOCAL_STORAGE_KEY_CACHE"; (function () { if (localStorage && localStorage.getItem && localStorage.getItem(i)) { let n = JSON.parse(localStorage.getItem(i)); (localStorage.removeItem(i), window.FrontEnd.KycLoadingHelper_IsFirstTrigger = !0, n) && n.elementSelector && waitObject("userServices").then(() => { window.userServices.getCurrentUserInfo(function (t) { if (t) { window.SegmentClient && window.SegmentClient.Identify(t); switch (n.triggerType) { case "clickMarkingProduct": r(n); break; case "click": f(n); break; case "clickPhone": e(n); break; case "clickReturn": o(n); break; case "scrollReturn": window.scrollTo(0, n.triggerPositionTop); break; case "scrollToElement": s(n) }n.source == "loginForm" && (window.dataLayer = window.dataLayer || [], window.dataLayer.push({ event: "kyc.loginSucceeded", source: n.source })) } }) }) } })() };