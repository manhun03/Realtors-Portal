@model PagedList.IPagedList<Realtors_Portal.Models.Customer>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Quản lý khách hàng";
    Layout = "~/Views/Shared/_LayoutEmp.cshtml";
}

<link rel="stylesheet" href="@Url.Content("~/Content/clients/menu/asset/Style.css")" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<!-- Lớp bọc tổng thể để tránh menu che -->
<div class="page-wrapper">
    <div class="container-fluid px-4 py-4">
        <!-- Tiêu đề -->
        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
            <h3 class="fw-bold text-primary mb-0">
                <i class="bi bi-people-fill me-2"></i>Danh sách khách hàng
            </h3>
            <div>
                <a class="btn btn-outline-primary rounded-pill px-4" href="@Url.Action("Create")">
                    <i class="bi bi-person-plus me-1"></i> Thêm khách hàng
                </a>
            </div>
        </div>

        <!-- Bảng dữ liệu -->
        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light text-center text-uppercase small fw-semibold">
                            <tr>
                                <th>Username</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Số điện thoại</th>
                                <th>Ngày tạo</th>
                                <th>Cập nhật</th>
                                <th>Xác minh</th>
                                <th>Địa chỉ</th>
                                <th>Ngày tham gia</th>
                                <th>Loại KH</th>
                                <th>Vai trò</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            @if (Model != null && Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@(item.UserAccount?.Username ?? "—")</td>
                                        <td>@(item.FullName ?? "—")</td>
                                        <td>@(item.UserAccount?.Email ?? "—")</td>
                                        <td>@(item.UserAccount?.Phone ?? "—")</td>
                                        <td>@(item.UserAccount?.CreatedAt?.ToString("dd/MM/yyyy HH:mm") ?? "—")</td>
                                        <td>@(item.UserAccount?.UpdatedAt?.ToString("dd/MM/yyyy HH:mm") ?? "—")</td>
                                        <td>
                                            @if (item.UserAccount?.IsVerified == true)
                                            {
                                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Đã xác minh</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary"><i class="bi bi-x-circle me-1"></i>Chưa xác minh</span>
                                            }
                                        </td>
                                        <td>@(item.Address ?? "—")</td>
                                        <td>@(item.JoinDate?.ToString("dd/MM/yyyy") ?? "—")</td>
                                        <td>@(item.CustomerType ?? "—")</td>
                                        <td>@(item.UserAccount?.Role ?? "—")</td>
                                        <td>
                                            <div class="d-flex justify-content-center gap-2">
                                                <a class="btn btn-outline-info btn-sm rounded-pill px-3"
                                                   href="@Url.Action("Details", new { id = item.CustomerID })">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                                <a class="btn btn-outline-danger btn-sm rounded-pill px-3"
                                                   href="@Url.Action("Delete", new { id = item.CustomerID })"
                                                   onclick="return confirm('Bạn có chắc muốn xóa khách hàng này không?');">
                                                    <i class="bi bi-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="12" class="text-muted text-center py-4">
                                        <i class="bi bi-info-circle me-2"></i>Không có dữ liệu khách hàng.
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Phân trang -->
        <div class="d-flex justify-content-center mt-4">
            @Html.PagedListPager(
                Model,
                page => Url.Action("Index", new { page }),
                new PagedListRenderOptions
                {
                    Display = PagedListDisplayMode.Always,
                    UlElementClasses = new[] { "pagination", "pagination-lg" },
                    LiElementClasses = new[] { "page-item" },
                    LinkToPreviousPageFormat = "«",
                    LinkToNextPageFormat = "»",
                    LinkToFirstPageFormat = "Đầu",
                    LinkToLastPageFormat = "Cuối",
                    MaximumPageNumbersToDisplay = 5
                }
            )
        </div>
    </div>
</div>

<style>
    /* === NỀN TỔNG & OFFSET CHO HEADER === */
    body {
        background-color: #f4f5f7; /* màu nền giống batdongsan.com */
    }

    .page-wrapper {
        margin-top: 80px; /* tránh bị header fixed che */
        padding-bottom: 40px;
    }

    /* === STYLE BẢNG & TIÊU ĐỀ === */
    h3 {
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .card {
        background-color: #fff;
        border-radius: 16px;
        overflow: hidden;
    }

    table thead {
        background-color: #f8f9fa;
    }

    .table-hover tbody tr:hover {
        background-color: #f1f3f5;
        transition: 0.2s;
    }

    .badge {
        font-size: 0.85rem;
        padding: 6px 10px;
    }

    /* === PHÂN TRANG === */
    .pagination .page-item .page-link {
        color: #0d6efd;
        border-radius: 50%;
        margin: 0 3px;
        border: none;
    }

    .pagination .active .page-link {
        background-color: #0d6efd;
        color: white;
    }

    /* === BUTTON === */
    .btn-outline-info:hover {
        background-color: #0dcaf0;
        color: white;
    }

    .btn-outline-danger:hover {
        background-color: #dc3545;
        color: white;
    }
</style>
